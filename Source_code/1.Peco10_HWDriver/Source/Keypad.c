/*==================================================================================================
*                                        INCLUDE FILES
* 1) system and project includes
* 2) needed interfaces from external units
* 3) internal and external interfaces from this unit
==================================================================================================*/
#include "Keypad.h"

/*==================================================================================================
                                           CONSTANTS
==================================================================================================*/


/*==================================================================================================
                                       DEFINES AND MACROS
==================================================================================================*/

/*==================================================================================================
*                                              ENUMS
==================================================================================================*/

/*==================================================================================================
*                                  STRUCTURES AND OTHER TYPEDEFS
==================================================================================================*/

/*==================================================================================================
*                                  LOCAL VARIABLE DECLARATIONS
==================================================================================================*/

/*==================================================================================================
*                                  GLOBAL VARIABLE DECLARATIONS
==================================================================================================*/


/*==================================================================================================
*                                       FUNCTION PROTOTYPES
==================================================================================================*/


/*==================================================================================================
*                                         LOCAL FUNCTIONS
==================================================================================================*/

static void Select_Col(uint8_t Num_Col)
{
    IC_74hc595(~((uint8_t)0x1 << (Num_Col)));
    IC_74hc595(DUMMY_DATA);
    IC_74hc595_Output();
}

static void Release_Col(void)
{
    IC_74hc595(DUMMY_DATA);
    IC_74hc595(DUMMY_DATA);
    IC_74hc595_Output();
}

static GPIO_PinState Read_Row(uint8_t Num_Row)
{
    return (GPIO_PinState)IC_74ls151(Num_Row);
}

/*==================================================================================================
*                                        GLOBAL FUNCTIONS
==================================================================================================*/


char Keypad_Scan(void)
{
    char key;
    uint8_t i =0;
    Release_Col();
    for(i=0;i<NUM_COLS;i++)
    {
        /*Write logic 0 to column i*/
        Select_Col(i);
        for(uint8_t j=0;j<NUM_ROWS;j++)
        {
            /* Get row state sequentially */
            if(GPIO_PIN_RESET == Read_Row(j))
            {
                key = KeyMap[j][i];
                break;
            }
        }
    }
    return key;
}
